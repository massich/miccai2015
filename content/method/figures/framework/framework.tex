\documentclass{standalone}
\usepackage[utf8]{inputenc}
\usepackage{tikz}
\usetikzlibrary{shapes, positioning, fit, calc}

\input{./framework_icons.tex}


\begin{document}
\definecolor{c808080}{RGB}{128,128,128}
\definecolor{c999999}{RGB}{153,153,153}
\definecolor{cffffff}{RGB}{255,255,255}
\definecolor{c00ff00}{RGB}{0,255,0}
\definecolor{cffff00}{RGB}{255,255,0}
\definecolor{c00ffff}{RGB}{0,255,255}
\definecolor{c808000}{RGB}{128,128,0}
\definecolor{c008000}{RGB}{0,128,0}
\definecolor{ccccccc}{RGB}{204,204,204}

\newcommand{\bbox}{
  \draw [blue] (current bounding box.south west) rectangle (current bounding box.north east);
}

\newcommand{\labelPic}[1]{
\begin{tikzpicture}[ y=0.6pt,x=0.6pt,yscale=-1, inner sep=0pt, outer sep=0pt ]
  {#1} \bbox
\end{tikzpicture}
}

\newcommand{\normalPic}[1]{
\begin{tikzpicture}[ y=1pt,x=1pt,yscale=-1, inner sep=0pt, outer sep=0pt ]
  {#1} \bbox
\end{tikzpicture}
}


\begin{tikzpicture}[y=1pt,x=1pt,yscale=-1, inner sep=0pt, outer sep=0pt]

%% Drawing the Nodes
  % Original Image
  \node[label={below:test image}] at(0,0)
    (bwImage){\normalPic{\bwImage}};

  % Mapping
  \node[right=20pt of bwImage, label={below:Mapping}]
    (map){\normalPic{\map}};

  % features
  \node[above right=10pt and 10pt of map, label={below:Features}]
    (features){\normalPic{\featuresBlock}};

  % SVM
  \node[right=70pt of features, label={below:Classifier}]
    (svm){\normalPic{\classBlock}};

  % MRF
  \node[yshift=-130pt, label={below:MRF}] at ($(features)!0.5!(svm)$)
    (mrf){\normalPic{\mrfBlock}};

  % Graph-Cuts
  \node[below right=10pt and 10pt of svm, label={below:Minimization}]
    (min){\normalPic{\minimizationBlock}};

  % Re-map
  \node[right=10pt of min, label={below:Re-Mapping}]
    (remap){\normalPic{\map}};

  % Output
  \node[right=100pt of remap, label={below:Segmentation}]
    (output){\normalPic{\colorImage}};

%% Draw the links
  \path[draw, very thick]
    (bwImage) edge node {} (map)
    ($(bwImage.east)!0.5!(map.west)$) edge node {} (features.west)
    (map.east) edge node (pointmap){\normalPic{\pointMapping}} (features.south)
    (map.east) edge node {}(mrf.north)
    (features) edge node {\labelPic{\classificableSample}} (svm)
    (svm.east) edge node {} (min.north)
    (min) edge node {} (remap)
    (remap) edge node {\labelPic{\spMapping}} (output)
    (mrf.east) edge node {} (min.south)
  ;
  \path[draw, very thick]
    ($(bwImage.east)!0.5!(map.west)$) edge node {} (mrf.west)
  ;
  \node[right=10pt of pointmap] (rigitmap){\normalPic{\rigitMapping}};
  \node[right=10pt of rigitmap] (spmap){\labelPic{\spMapping}};

\end{tikzpicture}
\end{document}


